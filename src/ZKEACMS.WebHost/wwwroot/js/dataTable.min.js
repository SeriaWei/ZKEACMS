$(document).ready(function(){function n(n){return typeof n=="string"?(n||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n}$(".dataTable").each(function(){var t=[],i=[];$("thead th",this).each(function(r){var e=$(this).data("template"),o=$(this).data("order"),u=$(this).data("option"),s=$(this).data("key"),h=$(this).data("search-operator"),c=$(this).data("data-type"),l=$(this).data("format"),f;o&&i.push([r,o]);f=!0;s||(f=!1);t.push({data:s,render:function(t,i,r,f){var o,y,s,a,v;if(f.settings.columnSettings=f.settings.columnSettings||{},f.settings.columnSettings[f.col]=f.settings.columnSettings[f.col]||{},o=f.settings.columnSettings[f.col],o.searchOpeartor=h,o.dataType=c,o.format=l,u&&t!=null)for(y=t.toString(),o.option=u,s=0;s<u.length;s++)if(u[s].value==y){t=u[s].name;break}if(!e)return n(t);for(v in r)a=(a||e).replaceAll("{"+v+"}",n(r[v]||""));return a},orderable:f})});$(this).DataTable({autoWidth:!1,processing:!0,serverSide:!0,filter:!1,ajax:{url:$(this).data("source"),data:function(n,t){for(var i=0;i<n.columns.length;i++)$("tr.search>th:eq("+i+")",$("#"+t.sTableId)).find(".form-control").each(function(){n.columns[i].search[$(this).attr("name")]=$(this).val();n.columns[i].search.opeartor=$(this).data("opeartor")});return n},type:"POST"},columns:t,order:i,language:{lengthMenu:"每页 _MENU_ 条记录",zeroRecords:"没有找到记录",info:"第 _PAGE_ 页 ( 总共 _PAGES_ 页 , 总共 _TOTAL_ 条记录 )",infoEmpty:"无记录",infoFiltered:"(从 _MAX_ 条记录过滤)",paginate:{previous:"上一页",next:"下一页"},search:"关键字:"},initComplete:function(){this.api().columns().every(function(){var i=this,n,r,t,u;if(i.settings()[0].columnSettings)if(n=i.settings()[0].columnSettings[i[0][0]],n.searchOpeartor!="None"){if(r=n.option,t=null,r)for(t=$('<select class="form-control" name="value"><\/select>'),t.data("opeartor",n.searchOpeartor).data("data-type",n.dataType),t.append('<option value="">-- 请选择 --<\/option>'),u=0;u<r.length;u++)t.append('<option value="'+r[u].value+'">'+r[u].name+"<\/option>");else n.searchOpeartor=="Range"?(t=$('<div class="range-search"><div class="input-group"><input name="valueMin" class="form-control min" type="text" placeholder="大于"><div class="input-group-addon">-<\/div><\/div><input name="valueMax" class="form-control max" type="text" placeholder="小于"><\/div>'),$(".min",t).data("opeartor",n.searchOpeartor).data("data-type",n.dataType),$(".max",t).data("opeartor",n.searchOpeartor).data("data-type",n.dataType)):(t=$('<input class="form-control" type="text" name="value" placeholder="输入搜索..."/>'),t.data("opeartor",n.searchOpeartor),t.data("data-type",n.dataType));n.dataType=="DateTime"&&t.find(".form-control").datetimepicker({locale:"zh-cn",format:n.format});t.appendTo($(i.footer()))}else $('<a href="javascript:void(0)" class="reset-search glyphicon glyphicon-repeat"><\/a>').appendTo($(i.footer()))})}}).on("keyup change",function(n){if($(n.target).closest("tr.search").length>0&&(n.type=="change"||n.type=="keyup"&&n.keyCode==13)){var t=!0;$("tr.search>th .form-control",this).each(function(){if(t){var n=$(this).data("data-type");n=="DateTime"&&$(this).val()&&(Date.parse($(this).val())||(t=!1))}});t&&$(this).DataTable().draw()}}).on("click",".range-search .input-group-addon",function(){$(this).closest(".range-search").find("input.max").toggleClass("show")}).on("click",".reset-search",function(){$(".form-control",$(this).closest(".search")).each(function(){$(this).val("")}).first().trigger("change")}).on("click",".glyphicon.glyphicon-remove",function(){var n=$(this);return Easy.ShowMessageBox("提示","确认删除该数据吗？",function(){$.post(n.attr("href"),function(t){t.message?Easy.ShowMessageBox("提示",t.message):n.closest("table.dataTable").DataTable().draw()})},!0),!1})})});
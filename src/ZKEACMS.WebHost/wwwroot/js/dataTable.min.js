$(document).ready(function(){function n(n){return typeof n=="string"?(n||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n}$(".seach-terms .form-control").each(function(){$(this).removeAttr("readonly").removeAttr("disabled");$(this).is("select")&&$("option:first",this).val()&&$(this).prepend("<option selected><\/option>")});$(".dataTable").each(function(){var i=[],r=[],t;$("thead th",this).each(function(t){var e=$(this).data("template"),o=$(this).data("order"),u=$(this).data("option"),s=$(this).data("key"),h=$(this).data("search-operator"),c=$(this).data("data-type"),l=$(this).data("format"),f;o&&r.push([t,o]);f=!0;s||(f=!1);i.push({data:s,render:function(t,i,r,f){var o,y,s,a,v;if(f.settings.columnSettings=f.settings.columnSettings||{},f.settings.columnSettings[f.col]=f.settings.columnSettings[f.col]||{},o=f.settings.columnSettings[f.col],o.searchOpeartor=h,o.dataType=c,o.format=l,u&&t!=null)for(y=t.toString(),o.option=u,s=0;s<u.length;s++)if(u[s].value==y){t=u[s].name;break}if(!e)return n(t);for(v in r)a=(a||e).replaceAll("{"+v+"}",n(r[v]||""));return a},orderable:f})});t=$(this);t.DataTable({autoWidth:!1,processing:!0,serverSide:!0,filter:!1,ajax:{url:$(this).data("source"),data:function(n){for(var i,u,o=t.closest(".grid-component").find(".seach-terms").find(".form-control"),f=0;f<o.length;f++){var r=$(o[f]),e=r.attr("name").toLowerCase(),s=!1;for(i=0;i<n.columns.length;i++)if(n.columns[i].data.toLowerCase()==e){n.columns[i].search.value=r.val();n.columns[i].search.opeartor=r.data("opeartor");r.data("opeartor")==9&&(n.columns[i].search.index?n.columns[i].search.valueMax=r.val():n.columns[i].search.valueMin=r.val(),n.columns[i].search.index=1);s=!0;break}s||(u={data:e,name:e,orderable:!1,search:{value:r.val(),regex:!1,opeartor:r.data("opeartor")},searchable:!0},u.search.opeartor==9&&(u.search.valueMin=r.val(),u.search.index=1),n.columns.push(u))}return n},type:"POST"},columns:i,order:r,language:{lengthMenu:"每页 _MENU_ 条记录",zeroRecords:"没有找到记录",info:"第 _PAGE_ 页 ( 总共 _PAGES_ 页 , 总共 _TOTAL_ 条记录 )",infoEmpty:"无记录",infoFiltered:"(从 _MAX_ 条记录过滤)",paginate:{previous:"上一页",next:"下一页"},search:"关键字:"}}).on("keyup change",function(n){if($(n.target).closest("tr.search").length>0&&(n.type=="change"||n.type=="keyup"&&n.keyCode==13)){var t=!0;$("tr.search>th .form-control",this).each(function(){if(t){var n=$(this).data("data-type");n=="DateTime"&&$(this).val()&&(Date.parse($(this).val())||(t=!1))}});t&&$(this).DataTable().draw()}}).on("click",".range-search .input-group-addon",function(){$(this).closest(".range-search").find("input.max").toggleClass("show")}).on("click",".reset-search",function(){$(".form-control",$(this).closest(".search")).each(function(){$(this).val("")}).first().trigger("change")}).on("click",".glyphicon.glyphicon-remove",function(){var n=$(this);return Easy.ShowMessageBox("提示","确认删除该数据吗？",function(){$.post(n.attr("href"),function(t){t.message?Easy.ShowMessageBox("提示",t.message):n.closest("table.dataTable").DataTable().draw()})},!0),!1})});$(document).on("click",".seach-terms .btn.search",function(){$(this).closest(".grid-component").find(".dataTable").DataTable().draw()})});
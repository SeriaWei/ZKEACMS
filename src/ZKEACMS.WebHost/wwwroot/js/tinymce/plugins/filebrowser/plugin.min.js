/*!
 * http://www.zkea.net/
 * Copyright 2016 ZKEASOFT
 * http://www.zkea.net/licenses
 */
tinymce.PluginManager.add("filebrowser",function(n){function t(){tinymce.activeEditor.windowManager.open({url:"/admin/Media/MultiSelect",width:1024,height:600,title:"媒体库",resizable:!0,buttons:[{text:"确定",onclick:function(t){var r=$(t.currentTarget).find("iframe")[0],f=r.contentDocument||r.contentWindow.document,u=$(f).find(".multi-select:not(.unchecked)");if(u.length==0){tinymce.activeEditor.windowManager.alert("请先选择要使用的媒体资源！");return}u.each(function(){var t=i({src:$(this).data("result"),name:$(this).data("name")});t.ele&&n.undoManager.transact(function(){n.selection.setContent(n.dom.createHTML(t.ele,t.attr,t.innerText))})});n.focus();n.nodeChanged();tinymce.activeEditor.windowManager.close()},classes:"primary"},{text:"取消",onclick:"close"}]}).$el.find("iframe").on("load",function(){var t=this.contentDocument||this.contentWindow.document;$(t).on("click",".confirm",function(){var t=i({src:$(this).data("result"),name:$(this).data("name")});t.ele&&(n.undoManager.transact(function(){n.selection.setContent(n.dom.createHTML(t.ele,t.attr,t.innerText))}),n.focus(),n.nodeChanged());tinymce.activeEditor.windowManager.close()})})}function i(n){var r=n.src,i=n.name,t={ele:"",attr:{},innerText:""},u=r.toLowerCase();return/.*(\.jpg|\.gif|\.png|\.jpeg|\.bmp|\.jpe)$/.test(u)?(t.ele="img",t.attr={src:r,title:i,alt:i}):/.*(\.mp4)$/.test(u)?(t.ele="video",t.attr={controls:"controls",src:r,title:i}):(t.ele="a",t.attr={href:r,"class":"btn btn-default",download:i,title:i},t.innerText="下载"),t}n.addCommand("filebrowser",t);n.addButton("filebrowser",{icon:"browse",tooltip:"媒体库",onclick:t});n.addMenuItem("filebrowser",{icon:"browse",text:"媒体库",onclick:t,context:"insert",prependToContext:!0})});
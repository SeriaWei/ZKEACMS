/*! http://www.zkea.net/
 * Copyright (c) ZKEASOFT. All rights reserved.
 * http://www.zkea.net/licenses */
$(function(){$("input,select,textarea",".input-group-collection .Template").each(function(){$(this).prop("disabled")||($(this).prop("disabled",!0),$(this).attr("editable",!0))});$(document).on("click",".input-group-collection .add",function(){var i=$(this).siblings(".items").children(".item").size(),u=$(this).siblings(".Template"),n=$(u.html()),f=u.children().data("name"),t=0,r;f.replace(/\[(\d+)\]/g,function(n){return t++,n});$("input,select,textarea",n).attr("data-val",!0).each(function(){var r,u,n;$(this).attr("editable")&&($(this).prop("disabled",!1),$(this).removeAttr("editable"));r=$(this).attr("name");r&&(n=0,$(this).attr("name",r.replace(/\[(\d+)\]/g,function(r){n++;return n==t?"["+i+"]":r})));u=$(this).attr("id");u&&(n=0,$(this).attr("id",u.replace(/\_(\d+)\_/g,function(r){n++;return n==t?"_"+i+"_":r})));$(this).hasClass("Date")&&!$(this).prop("readonly")&&!$(this).prop("disabled")&&$.fn.datetimepicker&&$(this).datetimepicker({locale:"zh-CN",format:$(this).attr("JsDateFormat")})});$("label",n).each(function(){var r=$(this).attr("for"),n;r&&(n=0,$(this).attr("for",r.replace(/\_(\d+)\_/g,function(r){n++;return n==t?"_"+i+"_":r})))});$(".field-validation-error,.field-validation-valid",n).each(function(){var r=$(this).attr("data-valmsg-for"),n=0;$(this).attr("data-valmsg-for",r.replace(/\[(\d+)\]/g,function(r){n++;return n==t?"["+i+"]":r}))});n.find(".ActionType").val($(this).data("value"));$(this).siblings(".items").append(n);$(".dy-editor:visible",n).trigger("init-editor");r=$(this).closest("form");r.removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(r[0]);n.trigger("list.added")});$(document).on("click",".input-group-collection .delete",function(){var t=$(this).closest("form"),n=!0;$("input,select,textarea",$(this).parent()).each(function(){$(this).hasClass("required")&&!$(this).val()&&($(this).is("select")?$(this).val($("option:last",this).val()):$(this).val("None"));n&&(n=t.validate().element("#"+$(this).attr("id")))});n&&($(this).parent().hide(),$(this).siblings(".hide").find(".ActionType").val($(this).data("value")));$(this).parent().trigger("list.remove")});$(document).on("change",".input-group-collection .form-control",function(){var n=$(".ActionType",$(this).closest(".item"));n.val()!=="Create"&&n.val("Update")});$.fn.sortable&&$(".input-group-collection .items.sortable").sortable({tolerance:"pointer",stop:function(n,t){var i=t.item.closest(".items"),r=i.find(".item");r.each(function(n){var i=$(this).data("name"),t=0;i.replace(/\[(\d+)\]/g,function(n){return t++,n});$("input,select,textarea",this).each(function(){var u=$(this).attr("name"),r,i;u&&(i=0,$(this).attr("name",u.replace(/\[(\d+)\]/g,function(r){i++;return i==t?"["+n+"]":r})));r=$(this).attr("id");r&&(i=0,$(this).attr("id",r.replace(/\_(\d+)\_/g,function(r){i++;return i==t?"_"+n+"_":r})))});$("label",this).each(function(){var r=$(this).attr("for"),i;r&&(i=0,$(this).attr("for",r.replace(/\_(\d+)\_/g,function(r){i++;return i==t?"_"+n+"_":r})))})});i.trigger("list.sorted")}})});
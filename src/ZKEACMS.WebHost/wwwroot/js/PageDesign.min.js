$(function(){$(".zone").sortable({items:">div:not(.zoneName)",placeholder:"sorting",handle:".sort-handle",tolerance:"pointer",connectWith:".zone",stop:function(n,t){var r=t.item.parent(),i;return t.item.data("add")&&$.ajax({type:"POST",url:$("#append-widget-url").val(),dataType:"html",async:!1,data:{ID:t.item.data("id"),ZoneID:$("input.zoneId",this).val(),PageID:$("#pageId").val(),AssemblyName:t.item.data("assemblyname"),ServiceTypeName:t.item.data("servicetypename"),Position:1},success:function(n){t.item.replaceWith(n)}}),i=[],r.find(".widget-design").each(function(n,t){i.push({ID:$(t).data("widgetid"),ZoneId:$(".zoneId",r).val(),Position:n+1})}),$.ajax({type:"POST",url:$("#save-widget-zone-url").val(),dataType:"json",contentType:"application/json;charset=utf-8",async:!1,data:JSON.stringify(i),success:function(){}}),!0}});$(".templates ul li").draggable({helper:"clone",connectToSortable:".zone"});$(document).on("click",".zoneToolbar .delete",function(){var n=$(this);$.post(n.data("url"),{ID:n.data("id")},function(n){n&&$("#widget_"+n).parent().remove()},"json")});$(document).on("click",".templates .tool-open",function(){$(this).parent().toggleClass("active")}).on("click",".templates .delete-template",function(){var n=$(this);Easy.ShowMessageBox("提示","确定要删除该模板吗？",function(){$.post(n.data("url"),{Id:n.data("id")},function(n){n&&$("#template_"+n).remove()},"json")},!0,10)}).on("click",".upload-template",function(){$("#template-file").trigger("click")}).on("change","#template-file",function(){$("#template-form").submit()}).on("click",".zoneToolbar .toggle-widget-class",function(){var n=$(this).data("class");$(this).closest(".widget").toggleClass(n);$.post($(this).data("action"),{clas:n},function(){})}).on("click",".zoneToolbar .custom-style-editor",function(){$(".custom-style-target").removeClass("custom-style-target");var t=$(this).data("action"),n=$(this).closest(".widget").parent();n.toggleClass("custom-style-target");window.top.Easy.ShowUrlWindow({url:"/admin/StyleEditor/Edit",width:1024,title:"编辑样式",onLoad:function(n){n.addClass("loaded")},callBack:function(){$.post(t,{style:n.attr("style")},function(){})},isDialog:!1});$(".WeiWindow.BoxShadow").addClass("StyleEditor")}).on("click",".copy-widget",function(){$.post($(this).data("action"),function(n){Easy.MessageTip.Show(n.message)})}).on("click",".paste-widget",function(){var n=$(this).closest(".zone");return n.data("pasting")||(n.data("pasting",!0),$.post($(this).attr("href"),{Position:$(".widget",n).size()+1},function(t){n.append(t);n.data("pasting",!1)},"html")),!1});$(".helper").click(function(){$("#containers").toggleClass($(this).data("class"))});$(window).width()>1600&&$(".templates").addClass("active");$(document).on("show.bs.modal","#mobile-frame",function(){window.innerHeight<740?$(".mobile",this).addClass("mini"):$(".mobile",this).removeClass("mini");$("iframe",this).attr("src",$(this).data("src"))});$(document).on("hidden.bs.modal","#mobile-frame",function(){$("iframe",this).html("").attr("src","about:blank")})});
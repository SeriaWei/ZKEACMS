/*!
 * http://www.zkea.net/
 * Copyright 2017 ZKEASOFT
 * http://www.zkea.net/licenses
 */
$(function(){$(".accordion-group>a").click(function(){var t=$(this),e=t.nextAll(".accordion-inner");return t.hasClass("active")?(t.removeClass("active"),e.hide(200)):(t.addClass("active"),e.show(200)),!1}),$(document).on("click",".cancel",function(){window.history.back()}).on("click",".publish",function(){return!!confirm("确认要发布吗？")}).on("click","input[type=submit]",function(){return $("#ActionType").val($(this).data("value")),!0}).on("click",".input-group .glyphicon.glyphicon-search",function(){var t=$(this);window.top.Easy.ShowUrlWindow({url:t.parent().siblings("input.form-control").data("url"),width:t.parent().siblings("input.form-control").data("width")||800,onLoad:function(e){var i=this;$(this.document).find("#confirm").click(function(){var a=t.parent().siblings("input.form-control");a.val(i.GetSelected()),e.close(),a.trigger("change")}),$(this.document).on("click",".confirm",function(){var i=t.parent().siblings("input.form-control");i.val($(this).data("result")),e.close(),i.trigger("change")})}})}).on("click",".form-group select#ZoneID",function(){var t=$(this),e="/admin/Layout/SelectZone?layoutId="+$(".hide #LayoutID").val()+"&pageId="+$(".hide #PageID").val()+"&zoneId="+t.val();window.top.Easy.ShowUrlWindow({url:e,width:1e3,title:"选择区域",onLoad:function(e){var i=this;$(this.document).find("#confirm").click(function(){t.val(i.GetSelected()),e.close()})}})}).on("click",".custom-style-editor",function(){window.top.Easy.ShowUrlWindow({url:"/admin/StyleEditor/Edit",width:1024,title:"编辑样式",onLoad:function(t){t.addClass("loaded")},isDialog:!1}),$(".WeiWindow.BoxShadow").addClass("StyleEditor")}).on("click",".form-group select.select",function(){var t=$(this);window.top.Easy.ShowUrlWindow({url:t.data("url")+"?selected="+t.val(),width:t.data("width")||800,onLoad:function(e){var i=this;$(this.document).find("#confirm").click(function(){t.val(i.GetSelected()),e.close(),t.trigger("change")}),$(this.document).on("click",".confirm",function(){t.val($(this).data("result")),e.close(),t.trigger("change")})}})}).on("submit","form",function(){Easy.Block()}),$(".form-group select#ZoneID,.form-group select.select").on("mousedown",!1),$.fn.datetimepicker&&$(".Date").each(function(){$(this).prop("readonly")||$(this).prop("disabled")||($(this).datetimepicker({locale:"zh-CN",format:$(this).attr("JsDateFormat")}),$(this).closest(".input-group").find(".glyphicon-calendar").click(function(){$(this).closest(".input-group").find("input").focus()}))}),$(document).on("click",".nav.nav-tabs a",function(){return $(this).tab("show"),!1}),$(".nav.nav-tabs").each(function(){var t=!1;$("li",this).each(function(){$(this).hasClass("active")&&($(this).removeClass("active"),$("a",this).tab("show"),t=!0)}),t||($("li:first a",this).tab("show"),location.hash&&$("li a[href='"+location.hash+"']",this).tab("show"))}),$("#StyleClass.form-control").popover({trigger:"focus",html:!0,title:"自定义样式用法",content:function(){for(var t=[{name:"边框",value:"border"},{name:"文字居中",value:"align-center"},{name:"文字右对齐",value:"align-right"},{name:"图片边框",value:"image-border"},{name:"阴影",value:"box-shadow"},{name:"图片圆形",value:"image-circle"},{name:"取消外边距",value:"full"},{name:"居中容器",value:"container"}],e="<p clss='text-nowrap'>直接写样式例：<code>style=\"color:#fff\"</code></p><p>预定义样式：<ol>",i=0;i<t.length;i++)e+="<li>"+t[i].name+":<code>"+t[i].value+"</code></li>";return e+="</ol></p>"},placement:"bottom"}),$("input.select-image").popover({trigger:"focus",html:!0,title:"图片预览",content:function(){var t=$(this).val();return t?(0===t.indexOf("~")&&(t=t.replace("~",location.origin)),"<div style='width:244px;'><img src='"+t+"'/></div>"):null},placement:"bottom"}).on("change",function(){var t=$(this).val();t&&0!=t.indexOf("~/")&&0!=t.indexOf("/")&&0!=t.replace("http://","").replace("https://","").indexOf(window.location.hostname)?0==$(this).siblings(".image-local").length&&$('<div class="input-group-addon image-local"><span class="glyphicon glyphicon-floppy-open upload-external"></span></div>').insertAfter($(this)):$(this).siblings(".image-local").remove()}).trigger("change").parent().addClass("loading"),$(document).on("click",".image-local .upload-external",function(){var t=$(this).closest(".input-group");t.addClass("processing"),$.post("/admin/Media/DownLoadExternalImage",{images:[t.find("input").val()]},function(e){if(e)for(var i=0;i<e.length;i++)t.find("input").val(e[i].value).trigger("change");t.removeClass("processing")},"json")}),document.addEventListener&&document.addEventListener("paste",function(t){if(t.target.className&&t.target.className.indexOf("select-image")>=0){var e,i=t.target;if(t.clipboardData?e=t.clipboardData:window.clipboardData&&(e=window.clipboardData),e&&e.items)for(var a=0;a<e.items.length;a++)if(-1!==e.items[a].type.indexOf("image")){var n=e.items[a].getAsFile();if(n.size>1048e3)continue;i.parentNode.className=i.parentNode.className+" processing",i.value="图片上传中...";var o=new XMLHttpRequest;o.open("POST","/admin/media/Upload"),o.onload=function(t){i.parentNode.className=i.parentNode.className.replace(" processing","");var e=JSON.parse(t.target.response);e.id&&(i.value="~"+e.url,$(i).blur().focus())},o.onerror=function(){i.parentNode.className=i.parentNode.className.replace(" processing",""),i.value="图片上传失败"};var l=new FormData;l.append("file",n),l.append("folder","图片"),l.append("size",n.size),o.send(l);break}}}),$(".input-group .glyphicon.glyphicon-play").popover({trigger:"click",html:!0,title:"视频预览",content:function(){var t=$(this).parent().siblings("input").val();return t?(0===t.indexOf("~")&&(t=t.replace("~",location.origin)),"<div><video style='width:244px;height:183px' controls='controls' src='"+t+"'>您的浏览器不支持播放该视频</video></div>"):null},placement:"left"});var t=$("#main-menu");if(t.length>0){var e,i=0;$("a.menu-item",t).each(function(){var t=$(this).attr("href");t&&0===location.pathname.toLocaleLowerCase().indexOf(t.toLowerCase())&&t.length>i&&(e=$(this),i=t.length)}),e&&e.size()&&(e.addClass("active"),e.parent().hasClass("accordion-inner")&&(e.parent().show(),e.parent().prev().addClass("active")));var a=$(".menu-item.active",t).offset().top-t.offset().top,n=document.querySelector("#left-menu");function o(){n.style.height=window.innerHeight-133+"px"}o();var l=window.Scrollbar.init(n);$(window).on("resize",function(){Easy.Processor(o,500)}),a>0&&(l.scrollTop=a/2)}$("input,select,textarea",".input-group-collection .Template").each(function(){$(this).prop("disabled")||($(this).prop("disabled",!0),$(this).attr("editable",!0))}),$(document).on("click",".input-group-collection .add",function(){var t=$(this).siblings(".items").children(".item").size(),e=$($(this).siblings(".Template").html());$("input,select,textarea",e).attr("data-val",!0).each(function(){$(this).attr("editable")&&($(this).prop("disabled",!1),$(this).removeAttr("editable"));var e=$(this).attr("name");e&&$(this).attr("name",e.replace(/\[(\d+)\]/,"["+t+"]"));var i=$(this).attr("id");i&&$(this).attr("id",i.replace(/\_(\d+)\_/,"_"+t+"_")),$(this).hasClass("Date")&&!$(this).prop("readonly")&&!$(this).prop("disabled")&&$.fn.datetimepicker&&$(this).datetimepicker({locale:"zh-CN",format:$(this).attr("JsDateFormat")})}),$(".field-validation-error,.field-validation-valid",e).each(function(){var e=$(this).attr("data-valmsg-for");$(this).attr("data-valmsg-for",e.replace(/\[(\d+)\]/,"["+t+"]"))}),e.find(".ActionType").val($(this).data("value")),$(this).siblings(".items").append(e);var i=$(this).closest("form");i.removeData("validator").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(i[0])}).on("click",".input-group-collection .delete",function(){var t=$(this).closest("form"),e=!0;$("input,select,textarea",$(this).parent()).each(function(){$(this).hasClass("required")&&!$(this).val()&&($(this).is("select")?$(this).val($("option:last",this).val()):$(this).val("None")),e&&(e=t.validate().element("#"+$(this).attr("id")))}),e&&($(this).parent().hide(),$(this).siblings(".hide").find(".ActionType").val($(this).data("value")))}).on("change",".input-group-collection .form-control",function(){var t=$(".ActionType",$(this).closest(".item"));"Create"!==t.val()&&t.val("Update")}),$.fn.select2&&$("select[multiple='multiple']").select2()});
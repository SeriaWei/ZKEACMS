/*!
 * http://www.zkea.net/
 * Copyright 2017 ZKEASOFT
 * http://www.zkea.net/licenses
 */
$(function(){var n,t,i,r;$(".accordion-group>a").click(function(){return $(this).nextAll(".accordion-inner").hasClass("active")?!1:($(this).parents("ul").find(".accordion-inner.active").removeClass("active").hide(200),$(this).nextAll(".accordion-inner").addClass("active").show(200),!1)});$(document).on("click",".cancel",function(){window.history.back()}).on("click",".publish",function(){return confirm("确认要发布吗？")?!0:!1}).on("click","input[type=submit]",function(){return $("#ActionType").val($(this).data("value")),!0}).on("click",".input-group .glyphicon.glyphicon-search",function(){var n=$(this);window.top.Easy.ShowUrlWindow({url:n.parent().siblings("input.form-control").data("url"),width:n.parent().siblings("input.form-control").data("width")||800,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){var r=n.parent().siblings("input.form-control");r.val(i.GetSelected());t.close();r.trigger("change")});$(this.document).on("click",".confirm",function(){var i=n.parent().siblings("input.form-control");i.val($(this).data("result"));t.close();i.trigger("change")})}})}).on("click",".form-group select#ZoneID",function(){var n=$(this),t="/admin/Layout/SelectZone?layoutId="+$(".hide #LayoutID").val()+"&pageId="+$(".hide #PageID").val()+"&zoneId="+n.val();window.top.Easy.ShowUrlWindow({url:t,width:1e3,title:"选择区域",onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){n.val(i.GetSelected());t.close()})}})}).on("click",".custom-style-editor",function(){window.top.Easy.ShowUrlWindow({url:"/js/StyleEditor/index.html",width:1024,title:"编辑样式",onLoad:function(n){n.addClass("loaded")},isDialog:!1});$(".WeiWindow.BoxShadow").addClass("StyleEditor")}).on("click",".form-group select.select",function(){var n=$(this);window.top.Easy.ShowUrlWindow({url:n.data("url")+"?selected="+n.val(),width:n.data("width")||800,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){n.val(i.GetSelected());t.close();n.trigger("change")});$(this.document).on("click",".confirm",function(){n.val($(this).data("result"));t.close();n.trigger("change")})}})}).on("submit","form",function(){Easy.Block()});$(".form-group select#ZoneID,.form-group select.select").on("mousedown",!1);$.fn.datepicker&&$(".Date").each(function(){$(this).prop("readonly")||$(this).prop("disabled")||$(this).datepicker({language:"zh-CN",format:$(this).attr("JsDateFormat")})});$(document).on("click",".nav.nav-tabs a",function(){return $(this).tab("show"),!1});$(".nav.nav-tabs").each(function(){var n=!1;$("li",this).each(function(){$(this).hasClass("active")&&($(this).removeClass("active"),$("a",this).tab("show"),n=!0)});n||($("li:first a",this).tab("show"),location.hash&&$("li a[href='"+location.hash+"']",this).tab("show"))});$("#StyleClass.form-control").popover({trigger:"focus",html:!0,title:"自定义样式用法",content:function(){for(var t=[{name:"边框",value:"border"},{name:"文字居中",value:"align-center"},{name:"文字右对齐",value:"align-right"},{name:"图片边框",value:"image-border"},{name:"阴影",value:"box-shadow"},{name:"图片圆形",value:"image-circle"},{name:"取消外边距",value:"full"},{name:"居中容器",value:"container"}],i="<p clss='text-nowrap'>直接写样式例：<code>style=\"color:#fff\"<\/code><\/p><p>预定义样式：<ol>",n=0;n<t.length;n++)i+="<li>"+t[n].name+":<code>"+t[n].value+"<\/code><\/li>";return i+"<\/ol><\/p>"},placement:"bottom"});$("input.select-image").popover({trigger:"focus",html:!0,title:"图片预览",content:function(){var n=$(this).val();return n?(n.indexOf("~")===0&&(n=n.replace("~",location.origin)),"<div style='width:244px;'><img src='"+n+"'/><\/div>"):null},placement:"bottom"}).parent().addClass("loading");document.addEventListener&&document.addEventListener("paste",function(n){var t,i,r,e,u,f;if(n.target.className&&n.target.className.indexOf("select-image")>=0&&(t=n.target,n.clipboardData?i=n.clipboardData:window.clipboardData&&(i=window.clipboardData),i&&i.items))for(r=0;r<i.items.length;r++)if(i.items[r].type.indexOf("image")!==-1){if(e=i.items[r].getAsFile(),e.size>1048e3)continue;t.parentNode.className=t.parentNode.className+" processing";t.value="图片上传中...";u=new XMLHttpRequest;u.open("POST","/admin/media/Upload");u.onload=function(n){t.parentNode.className=t.parentNode.className.replace(" processing","");var i=JSON.parse(n.target.response);i.id&&(t.value="~"+i.url,$(t).blur().focus())};u.onerror=function(){t.parentNode.className=t.parentNode.className.replace(" processing","");t.value="图片上传失败"};f=new FormData;f.append("file",e);f.append("folder","图片");f.append("size",e.size);u.send(f);break}});$(".input-group .glyphicon.glyphicon-play").popover({trigger:"click",html:!0,title:"视频预览",content:function(){var n=$(this).parent().siblings("input").val();return n?(n.indexOf("~")===0&&(n=n.replace("~",location.origin)),"<div><video style='width:244px;height:183px' controls='controls' src='"+n+"'>您的浏览器不支持播放该视频<\/video><\/div>"):null},placement:"left"});n=$("#main-menu");n.length>0&&(i=0,$("a.menu-item",n).each(function(){var n=$(this).attr("href");n&&location.pathname.toLocaleLowerCase().indexOf(n.toLowerCase())===0&&n.length>i&&(t=$(this),i=n.length)}),t&&t.size()&&(t.addClass("active"),t.parent().hasClass("accordion-inner")&&(t.parent().show(),t.parent().prev().addClass("active"))),n.slimscroll({height:$(window).height()-170}),r=n.scrollTop()+$(".menu-item.active",n).offset().top-n.offset().top-n.height()/2,r>0&&n.scrollTop(r));$("input,select,textarea",".input-group-collection .Template").each(function(){$(this).prop("disabled")||($(this).prop("disabled",!0),$(this).attr("editable",!0))});$(document).on("click",".input-group-collection .add",function(){var t=$(this).siblings(".items").children(".item").size(),n=$($(this).siblings(".Template").html()),i;$("input,select,textarea",n).attr("data-val",!0).each(function(){var n,i;$(this).attr("editable")&&($(this).prop("disabled",!1),$(this).removeAttr("editable"));n=$(this).attr("name");n&&$(this).attr("name",n.replace(/\[(\d+)\]/,"["+t+"]"));i=$(this).attr("id");i&&$(this).attr("id",i.replace(/\_(\d+)\_/,"_"+t+"_"));!$(this).hasClass("Date")||$(this).prop("readonly")||$(this).prop("disabled")||$(this).datepicker({language:"zh-CN",format:$(this).attr("JsDateFormat")})});$(".field-validation-error,.field-validation-valid",n).each(function(){var n=$(this).attr("data-valmsg-for");$(this).attr("data-valmsg-for",n.replace(/\[(\d+)\]/,"["+t+"]"))});n.find(".ActionType").val($(this).data("value"));$(this).siblings(".items").append(n);i=$(this).closest("form");i.removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(i[0])}).on("click",".input-group-collection .delete",function(){var t=$(this).closest("form"),n=!0;$("input,select,textarea",$(this).parent()).each(function(){n&&(n=t.validate().element("#"+$(this).attr("id")))});n&&($(this).parent().hide(),$(this).siblings(".hide").find(".ActionType").val($(this).data("value")))}).on("change",".input-group-collection .form-control",function(){var n=$(".ActionType",$(this).closest(".item"));n.val()!=="Create"&&n.val("Update")})});
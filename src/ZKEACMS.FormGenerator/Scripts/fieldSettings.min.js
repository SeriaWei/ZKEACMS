angular.module("fieldSetting",[]).controller("setting",["$scope","$filter",function(n,t){n.templates=[{Name:"Label",DisplayName:"标题",Description:"",Placeholder:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"SingleLine",DisplayName:"单行输入",Description:"",Placeholder:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"Number",DisplayName:"数字",Description:"",Placeholder:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"Email",DisplayName:"邮箱地址",Description:"",Placeholder:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"Paragraph",DisplayName:"多行输入",Description:"",Placeholder:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"Date",DisplayName:"日期",Description:"",IsRequired:!1,Size:4,Column:"col-md-12"},{Name:"Radio",DisplayName:"单项选择",Description:"",IsRequired:!1,Size:4,Column:"col-md-12",FieldOptions:[{DisplayText:"选项1"},{DisplayText:"选项2"}]},{Name:"Dropdown",DisplayName:"下拉选项",Description:"",IsRequired:!1,Size:4,Column:"col-md-12",FieldOptions:[{DisplayText:"选项1"},{DisplayText:"选项2"}]},{Name:"Checkbox",DisplayName:"多项选择",Description:"",IsRequired:!1,Size:4,Column:"col-md-12",FieldOptions:[{DisplayText:"选项1"},{DisplayText:"选项2"}]},{Name:"Address",DisplayName:"省份地址",Description:"",IsRequired:!1,Size:4,Column:"col-md-12"}];(n.Fields==null||n.Fields.length==0)&&(n.Fields=[angular.copy(n.templates[0])]);n.fieldInfo=n.Fields[0];n.editTemplate=function(t){n.fieldInfo=t};n.setFieldWidth=function(n,t){n.Style={width:t}};n.setDefaultOption=function(n,t){for(var i=0;i<n.FieldOptions.length;i++)n.FieldOptions[i].DefaultSelected=!1;t.DefaultSelected=!0;n.DefaultSelect=t};n.removeField=function(t){n.Fields=n.Fields.filter(function(n){return n!=t})};n.removeOption=function(n,t){for(var r=0,i=0;i<n.length;i++)n[i]==t&&(r=i);n.splice(r,1)};n.addOption=function(n){n.push({DisplayText:"",Value:"",DefaultSelected:!1})};var i=t("orderBy");n.sortOptions=function(n,t){n=i(n,"DisplayText",t);for(var r=0;r<n.length;r++)n[r].Order=r+1};n.showOptionValue=function(n,t){n.ShowValue=t;for(var i=0;i<n.FieldOptions.length;i++)n.FieldOptions[i].Value||(n.FieldOptions[i].Value=n.FieldOptions[i].DisplayText)};n.dragOver=function(t){for(var r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}n.Fields[r].onDrop=!0;n.$apply();t.preventDefault()};n.dragLeave=function(t){for(var r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}n.Fields[r].onDrop=!1;n.$apply();t.preventDefault()};n.drag=function(n){var i,t;for(n.dataTransfer.setData("Field",n.target.id),i=0,t=0;t<n.currentTarget.parentNode.children.length;t++)if(n.currentTarget===n.currentTarget.parentNode.children[t]){i=t;break}n.dataTransfer.setData("StartIndex",i)};n.drop=function(t){var u,r,i,f;for(t.preventDefault(),u=t.dataTransfer.getData("Field"),r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}if(n.Fields[r].onDrop=!1,u)for(i=0;i<n.templates.length;i++)u==n.templates[i].Name&&n.Fields.splice(r+1,0,angular.copy(n.templates[i]));else f=parseInt(t.dataTransfer.getData("StartIndex")),n.Fields.splice(r,0,n.Fields.splice(f,1)[0]);n.$apply()};n.columnCute=function(n){return n.Column||"col-md-12"};n.save=function(){if(n.Message=null,!$.trim(n.Title)){n.Message="请输入表单的名称";return}Easy.Block();$.ajax({type:"POST",dataType:"json",url:n.saveUrl,data:JSON.stringify({ID:n.ID,Title:n.Title,NotificationReceiver:n.NotificationReceiver,Description:n.Description,FormFields:n.Fields}),contentType:"application/json; charset=utf-8",async:!0,success:function(t){t.message?(n.Message=t.message,n.$apply()):window.location.href="/Admin/Form"}})}}]);